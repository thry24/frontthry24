<!-- src/app/pages/dashboard/dashboard.page.html -->
<div class="dashboard-container" *ngIf="!loading; else cargando">

  <!-- ✅ COLUMNA PRINCIPAL -->
  <div class="dashboard-main">

    <!-- ✅ OBJETIVOS -->
    <div class="objetivos-card">
      <div class="tabs">
        <button [class.active]="activeTab === 'mensual'" (click)="setTab('mensual')">
          <ion-icon name="target-outline"></ion-icon> Objetivo del mes
        </button>

        <button [class.active]="activeTab === 'anual'" (click)="setTab('anual')">
          <ion-icon name="trophy-outline"></ion-icon> Objetivo Anual
        </button>
      </div>

      <!-- MENSUAL -->
      <div class="objetivos-form" *ngIf="activeTab === 'mensual'">
        <div class="objetivo-row">
          <ion-icon name="checkmark-circle-outline"></ion-icon>
          <label>Objetivo comisiones (mes)</label>
          <input type="text"
                 [value]="objetivoMesActual | currency:'MXN':'symbol-narrow':'1.0-0'"
                 readonly>
          <input type="number" [(ngModel)]="inputComisionesMes" min="0" step="1000" [disabled]="saving">
        </div>

        <div class="objetivo-row">
          <ion-icon name="checkmark-circle-outline"></ion-icon>
          <label>Objetivo Propiedades Añadidas</label>
          <input type="number" [(ngModel)]="inputPropsMes" min="0" [disabled]="saving">
          <input type="number" [value]="propiedadesTotal" readonly>
        </div>

        <div class="objetivo-row">
          <ion-icon name="checkmark-circle-outline"></ion-icon>
          <label>Objetivo Leads</label>
          <input type="number" [(ngModel)]="inputLeadsMes" min="0" [disabled]="saving">
          <small>Total mes: {{ leadsMesTotales }}</small>
        </div>

        <button class="guardar" (click)="guardarMensual()" [disabled]="saving">
          {{ saving ? 'Guardando...' : 'Guardar objetivo mensual' }}
        </button>
      </div>

      <!-- ANUAL -->
      <div class="objetivos-form" *ngIf="activeTab === 'anual'">
        <div class="objetivo-row">
          <ion-icon name="checkmark-circle-outline"></ion-icon>
          <label>Objetivo comisiones (anual)</label>
          <input type="number" [(ngModel)]="inputComisionesAnual" min="0" step="10000" [disabled]="saving">
          <small>YTD: {{ comisionesYTD | currency:'MXN':'symbol-narrow':'1.0-0' }}</small>
        </div>

        <button class="guardar" (click)="guardarAnual()" [disabled]="saving">
          {{ saving ? 'Guardando...' : 'Guardar objetivo anual' }}
        </button>
      </div>
    </div>

    <!-- ✅ MÉTRICAS -->
    <div class="metricas">
      <div class="card"><h3>Objetivo</h3><strong>{{ objetivoMesActual | currency:'MXN' }}</strong>
       <br> <span>Target: {{ targetMes | currency:'MXN' }}</span></div>
      <div class="card"><h3>Mes Anterior</h3><br><strong>{{ mesAnterior | currency:'MXN' }}</strong></div>
      <div class="card"><h3>Propiedades Total</h3><strong>{{ propiedadesTotal }}</strong></div>
      <div class="card"><h3>Comisiones</h3><br><strong>{{ comisionesYTD | currency:'MXN' }}</strong></div>
    </div>

    <div class="seccion-card leads-origen">
      <h4><ion-icon name="bar-chart-outline"></ion-icon> Leads por origen</h4>
      <ul>
        <li *ngFor="let item of leadsPorOrigen">
          <strong>{{ item.origen }}</strong>: {{ item.total }}
        </li>
      </ul>
    </div>

    <div class="seccion-card leads-propiedad">
      <h4><ion-icon name="pin-outline"></ion-icon> Leads por propiedad</h4>
      <table>
        <thead>
          <tr>
            <th>Propiedad</th>
            <th>Leads</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let row of leadsPorPropiedad">
            <td>{{ row.propiedad }}</td>
            <td>{{ row.total }}</td>
          </tr>
        </tbody>
      </table>
    </div>


    <!-- ✅ GRÁFICAS (abajo) -->
    <div class="graficas">
      <div class="grafica"><div #elComisiones></div></div>
      <div class="grafica"><div #elCerradas></div></div>
      <div class="grafica"><div #elTipos></div></div>
      <div class="grafica"><div #elIngresadas></div></div>
    </div>

  </div>

  <!-- ✅ BANNERS A LA DERECHA -->
  <div class="banners-panel">
    <div class="banner">
      <img src="https://img.freepik.com/premium-psd/real-estate-facebook-cover-social-media-instagram-post-web-banner-template_542922-470.jpg">
      <div class="info"><strong>$1.2M</strong><p>Parkside Residence<br/>New York</p></div>
    </div>
    <div class="banner">
      <img src="https://tse1.mm.bing.net/th/id/OIP.hrFUjBVLSb863YVM1sC_rAHaHa">
      <div class="info"><strong>$3,200</strong><p>Apartment Seattle</p></div>
    </div>
    <button class="ver-mas">Ver más</button>
  </div>

</div>

<ng-template #cargando><ion-spinner></ion-spinner></ng-template>
<div *ngIf="error" class="error">{{ error }}</div>
