<ion-content class="chat-crm-bg">
  <div *ngIf="!tieneSeguimiento; else vistaSeguimiento" class="sin-seguimientos">
    <h2>AÚN NO TIENES SEGUIMIENTOS</h2>
  </div>

  <ng-template #vistaSeguimiento>
    <div class="seguimiento-container" [class.estado-cerrado]="!mostrarLineaTiempo">
      <!-- 🔹 Selector de seguimiento -->
      <div *ngIf="seguimientos.length > 1" class="seguimientos-selector">
        <label>Selecciona seguimiento:</label>
        <select [(ngModel)]="idSeguimiento" (change)="seleccionarSeguimientoPorId(idSeguimiento)">
          <option *ngFor="let s of seguimientos" [value]="s._id">
            {{ s.clienteNombre || s.clienteEmail }}
          </option>
        </select>
      </div>

      <!-- Encabezado -->
      <div class="seguimiento-header-azul">
        <div class="col">Nombre Cliente</div>
        <div class="col">Tipo de Cliente</div>
        <div class="col">Tipo de Operación</div>
        <div class="col">Estatus de operación</div>
        <div class="col">Detalles del proceso</div>
        <div class="col">Fecha de Finalización</div>
      </div>

      <!-- Datos -->
      <div class="seguimiento-datos">
        <div class="col">{{ seguimientoCliente.clienteNombre }}</div>
        <div class="col">{{ seguimientoCliente.tipoCliente }}</div>

        <div class="col">
          <select [(ngModel)]="tipoOperacionCliente" (change)="onCambiarTipoOperacion(tipoOperacionCliente)">
            <option value="">Seleccionar</option>
            <option value="VENTA">VENTA</option>
            <option value="RENTA">RENTA</option>
          </select>
        </div>

        <div class="col">
          <select [(ngModel)]="estatusSeleccionado">
            <option value="">Seleccionar opción</option>
            <option *ngFor="let opcion of estatusOperacionOpciones" [value]="opcion">
              {{ opcion }}
            </option>
          </select>
          <div *ngIf="mostrarCampoOtra()">
            <input type="text" [(ngModel)]="estatusOtraMotivo" placeholder="Especifica el motivo" />
          </div>
        </div>

        <div class="col">
          <a class="clickable" (click)="mostrarLineaTiempo = !mostrarLineaTiempo">Ver línea</a>
        </div>

        <div class="col">
          <input type="date" [(ngModel)]="seguimientoCliente.fechaFinalizacion" />
        </div>
      </div>

      <div style="margin: 12px;">
        <ion-button expand="block" color="success" (click)="guardarCambios()">
          Guardar cambios
        </ion-button>
      </div>

      <div class="timeline-wrapper" *ngIf="mostrarLineaTiempo">
        <div class="timeline-inner">
          <div
            class="timeline-step"
            *ngFor="let paso of (tipoOperacionCliente === 'VENTA' ? timelineVenta : timelineRenta); let i = index"
          >
            <div class="dot color-{{ i + 1 }}"></div>
            <div class="info">
              <h4>{{ paso.paso }}</h4>
              <ng-container [ngSwitch]="paso.tipo">
                <!-- Si es un paso con fecha -->
                <p *ngSwitchCase="'fecha'">
                  Fecha:
                  <input 
                    type="date"
                    [(ngModel)]="seguimientoCliente[paso.campo!]"
                    (change)="paso.campo === 'fechaCita' && onFechaCitaChange()"
                  />

                  <button
                    *ngIf="paso.campo === 'fechaCita'"
                    class="btn-cita"
                    (click)="programarCita()"
                  >
                    📅 Agendar
                  </button>
                </p>
                <!-- Si es checkbox -->
                <label *ngSwitchCase="'check'">
                  <input type="checkbox" [(ngModel)]="seguimientoCliente[paso.campo!]" />
                  Documentos completos
                </label>
              </ng-container>
            </div>
          </div>
        </div>
      </div>
      </div> <!-- cierre del timeline -->
  </ng-template>
<ion-modal [isOpen]="mostrarModalCita" (didDismiss)="mostrarModalCita = false">
  <ng-template>
    <ion-header translucent="true">
      <ion-toolbar>
        <ion-title>Seleccionar Hora</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="mostrarModalCita = false">
            <ion-icon name="close"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="modal-cita-content">
      <p>Horas disponibles:</p>

      <ion-list>
        <ion-radio-group [(ngModel)]="horaSeleccionada">
          <ion-item *ngFor="let h of horasDisponibles">
            <ion-label>{{ h }}</ion-label>
            <ion-radio slot="end" [value]="h"></ion-radio>
          </ion-item>
        </ion-radio-group>
      </ion-list>

      <ion-button expand="block" color="success" (click)="confirmarCita()">Confirmar cita</ion-button>
      <ion-button fill="outline" expand="block" (click)="mostrarModalCita = false">Cancelar</ion-button>
    </ion-content>
  </ng-template>
</ion-modal>


</ion-content>
